<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Jan van der Laan" />
  <title>Introduction to working with code lists</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <style type="text/css">
body {
max-width: 50rem;
margin-left: auto;
margin-right: auto;
font-family: system-ui;
color: lightgray;
background: #555555;
}
p, li {
text-align: justify;
}
pre {
background: #444;
padding: 0.5rem;
}
h1, h2, h3, h4, h5 {
color: orange;
font-weight: bold;
}
h4, h5 {
color: inherit;
}
h2 {
margin-top: 3rem;
}
a {
color: orange;
}
a:hover {
color: lightblue;
}
pre code {
color: white;
background: inherit;
padding: 0;
}
code {
color: #e5c892;
background: #444;
padding: 0.2rem;
}

p.author {
font-weight : bold;
color: orange;
}

code {
color : lightgray;
}
code span.op {
color: #cccccc;
}
code span.kw, code span.cf {
color: #30bd58;
}
code span.st {
color: #76a9db; }
code span.dv, code span.ot, code span.fl{
color: #7fd0a8; }
code span.dt, code span.er {
color: #ee8c70; }
</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Introduction to working with code lists</h1>
<p class="author">Jan van der Laan</p>
</header>
<!--
%\VignetteEngine{simplermarkdown::mdweave_to_html}
%\VignetteIndexEntry{Introduction to working with code lists}
-->
<p>The <code>codelist</code> package has an example code list and a data
set that used codes from that code list. We will start by demonstrating
how the package works using this example code list.</p>
<p>Let’s load the example code list:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(codelist)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">data</span>(objectcodes)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectcodes</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   code                  label parent locale missing</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     A                   Toys   <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>     EN       <span class="dv">0</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     B                  Tools   <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>     EN       <span class="dv">0</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   A01             Teddy Bear      A     EN       <span class="dv">0</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   A02                Toy Car      A     EN       <span class="dv">0</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   A03                Marbles      A     EN       <span class="dv">0</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>   B01                 Hammer      B     EN       <span class="dv">0</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>   B02         Electric Drill      B     EN       <span class="dv">0</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     A              Speelgoed   <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>     NL       <span class="dv">0</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>     B            Gereedschap   <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>     NL       <span class="dv">0</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>  A01              Teddybeer      A     NL       <span class="dv">0</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>  A02          Speelgoedauto      A     NL       <span class="dv">0</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span>  A03               Knikkers      A     NL       <span class="dv">0</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span>  B01                  Hamer      B     NL       <span class="dv">0</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span>  B02            Boormachine      B     NL       <span class="dv">0</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span>    X         Unknown object   <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>     EN       <span class="dv">1</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span>    X Onbekend type voorwerp   <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span>     NL       <span class="dv">1</span></span></code></pre></div>
<p>We see that the code list contains codes for encoding various types
of objects. A code list contains at the minimum a ‘code’ and ‘label’
column. The ‘code’ column can be any type; the ‘label’ column should be
a character column. With the ‘parent’ column it is possible to define
simple hierarchies. This columns should contain codes from the ‘code’
column. A missing value indicates a top-level code. With the ‘locale’
column it is possible to have different versions of the ‘label’ and
‘description’ (here missing) columns. It can be used for different
translations as here, but could also be used for different versions of
the labels and descriptions. The ‘missing’ column indicates whether or
not the code should be treated as a missing value. This column should be
interpretable as a logical column.</p>
<p>Note that, although code lists can contain a ‘parent’ column, the
current version of the <code>codelist</code> package does not contain
any functionality yet to work with these hierarchies. This could for
example be used to select all records whose codes fall in the ‘Toys’
domain, or to aggregate the data to the top level domains. Expect
functionality like this in future versions of the package.</p>
<p>We will also load and example data set using the codes we loaded
above:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">data</span>(objectsales)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectsales <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  product unitprice quantity totalprice</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     B01     <span class="fl">70.65</span>       <span class="dv">67</span>    <span class="fl">4733.55</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     B01     <span class="fl">76.93</span>       <span class="dv">76</span>    <span class="fl">5846.68</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     B01     <span class="fl">43.49</span>      <span class="dv">100</span>    <span class="fl">4349.00</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     A03      <span class="fl">3.08</span>       <span class="dv">26</span>      <span class="fl">80.08</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     A01     <span class="fl">18.51</span>       <span class="dv">89</span>    <span class="fl">1647.39</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     A03      <span class="fl">3.35</span>       <span class="dv">71</span>     <span class="fl">237.85</span></span></code></pre></div>
<p>This is a data set containing the prices and sales of various
products. The ‘product’ column uses codes from the
<code>objectcodes</code> code list:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectsales<span class="sc">$</span>product <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;B01&quot;</span> <span class="st">&quot;B01&quot;</span> <span class="st">&quot;B01&quot;</span> <span class="st">&quot;A03&quot;</span> <span class="st">&quot;A01&quot;</span> <span class="st">&quot;A03&quot;</span> <span class="st">&quot;A03&quot;</span> <span class="st">&quot;B01&quot;</span> <span class="st">&quot;A03&quot;</span> <span class="st">&quot;A01&quot;</span></span></code></pre></div>
<p>One of the things we can do is convert the codes to their
corresponding labels:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">label</span>(objectsales<span class="sc">$</span>product, objectcodes) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] Hammer     Hammer     Hammer     Marbles    Teddy Bear Marbles   </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] Marbles    Hammer     Marbles    Teddy Bear</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>Levels<span class="sc">:</span> Toys Tools Teddy Bear Toy Car Marbles Hammer Electric Drill</span></code></pre></div>
<p>The <code>label</code> function accepts a vector with codes and a
<code>codelist</code> for this vector. It can get a bit tiresome to keep
having to pass in the <code>codelist</code> attribute. If it is missing,
the looks for a ‘codelist’ attribute:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">attr</span>(objectsales<span class="sc">$</span>product, <span class="st">&quot;codelist&quot;</span>) <span class="ot">&lt;-</span> objectcodes</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">label</span>(objectsales<span class="sc">$</span>product) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] Hammer     Hammer     Hammer     Marbles    Teddy Bear Marbles   </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] Marbles    Hammer     Marbles    Teddy Bear</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>Levels<span class="sc">:</span> Toys Tools Teddy Bear Toy Car Marbles Hammer Electric Drill</span></code></pre></div>
<p>The <code>codelist</code> package also has a <code>coded</code> type.
Converting to a <code>coded</code> object adds the <code>coded</code>
class. This will result in some formatting and later on we will see that
this also ensures that we cannot assign invalid codes to the vector:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectsales<span class="sc">$</span>product <span class="ot">&lt;-</span> <span class="fu">coded</span>(objectsales<span class="sc">$</span>product, objectcodes)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectsales<span class="sc">$</span>product <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] B01 B01 B01 A03 A01 A03 A03 B01 A03 A01</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> Codelist<span class="sc">:</span> <span class="fu">A</span>(<span class="ot">=</span>Toys) <span class="fu">B</span>(<span class="ot">=</span>Tools) <span class="fu">A01</span>(<span class="ot">=</span>Teddy Bear) <span class="fu">A02</span>(<span class="ot">=</span>Toy Car) <span class="fu">...X</span>(<span class="ot">=</span>Unknown object)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">label</span>(objectsales<span class="sc">$</span>product) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] Hammer     Hammer     Hammer     Marbles    Teddy Bear Marbles   </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a> [<span class="dv">7</span>] Marbles    Hammer     Marbles    Teddy Bear</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>Levels<span class="sc">:</span> Toys Tools Teddy Bear Toy Car Marbles Hammer Electric Drill</span></code></pre></div>
<p>The <code>label</code> function can be used to get readable output
from various R-functions:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">table</span>(<span class="fu">label</span>(objectsales<span class="sc">$</span>product), <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>          Toys          Tools     Teddy Bear        Toy Car        Marbles </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>              <span class="dv">0</span>             <span class="dv">29</span>             <span class="dv">14</span>             <span class="dv">16</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        Hammer Electric Drill           <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="dv">30</span>              <span class="dv">2</span>              <span class="dv">9</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">tapply</span>(objectsales<span class="sc">$</span>unitprice, <span class="fu">label</span>(objectsales<span class="sc">$</span>product), mean)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>          Toys          Tools     Teddy Bear        Toy Car        Marbles </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="cn">NA</span>             <span class="cn">NA</span>      <span class="fl">19.761034</span>      <span class="fl">12.432857</span>       <span class="fl">2.480625</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        Hammer Electric Drill </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>     <span class="fl">45.303000</span>     <span class="fl">205.350000</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">lm</span>(unitprice <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span><span class="fu">label</span>(product), <span class="at">data =</span> objectsales) </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> unitprice <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">label</span>(product), <span class="at">data =</span> objectsales)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">label</span>(product)Teddy Bear         <span class="fu">label</span>(product)Toy Car  </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                      <span class="fl">19.761</span>                        <span class="fl">12.433</span>  </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>       <span class="fu">label</span>(product)Marbles          <span class="fu">label</span>(product)Hammer  </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>                       <span class="fl">2.481</span>                        <span class="fl">45.303</span>  </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(product)Electric Drill  </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>                     <span class="fl">205.350</span>  </span></code></pre></div>
<p>By default codes that are considered missing are converted to
<code>NA</code> when converting to labels. This can be prevented by
setting the <code>missing</code> argument to <code>TRUE</code> or by
using the <code>labelm</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">table</span>(<span class="fu">labelm</span>(objectsales<span class="sc">$</span>product), <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>          Toys          Tools     Teddy Bear        Toy Car        Marbles </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>             <span class="dv">0</span>              <span class="dv">0</span>             <span class="dv">29</span>             <span class="dv">14</span>             <span class="dv">16</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        Hammer Electric Drill Unknown object           <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="dv">30</span>              <span class="dv">2</span>              <span class="dv">5</span>              <span class="dv">4</span> </span></code></pre></div>
<p>The <code>droplevels</code> removes unused codes from the levels of
the generated factor vector:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">table</span>(<span class="fu">labelm</span>(objectsales<span class="sc">$</span>product, <span class="at">droplevels =</span> <span class="cn">TRUE</span>), <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    Teddy Bear        Toy Car        Marbles         Hammer Electric Drill </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            <span class="dv">29</span>             <span class="dv">14</span>             <span class="dv">16</span>             <span class="dv">30</span>              <span class="dv">2</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>Unknown object           <span class="sc">&lt;</span><span class="cn">NA</span><span class="sc">&gt;</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>             <span class="dv">5</span>              <span class="dv">4</span> </span></code></pre></div>
<h3 id="locale">Locale</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">label</span>(objectsales<span class="sc">$</span>product, <span class="at">locale =</span> <span class="st">&quot;NL&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] Hamer     Hamer     Hamer     Knikkers  Teddybeer Knikkers </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span> Levels<span class="sc">:</span> Speelgoed Gereedschap Teddybeer Speelgoedauto Knikkers ... Boormachine</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> op <span class="ot">&lt;-</span> <span class="fu">options</span>(<span class="at">CLLOCALE =</span> <span class="st">&quot;NL&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">tapply</span>(objectsales<span class="sc">$</span>unitprice, <span class="fu">label</span>(objectsales<span class="sc">$</span>product), mean)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    Speelgoed   Gereedschap     Teddybeer Speelgoedauto      Knikkers </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>           <span class="cn">NA</span>            <span class="cn">NA</span>     <span class="fl">19.761034</span>     <span class="fl">12.432857</span>      <span class="fl">2.480625</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        Hamer   Boormachine </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">45.303000</span>    <span class="fl">205.350000</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Set the locale back to the original value (unset)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">options</span>(op)</span></code></pre></div>
<h3 id="looking-up-codes-based-on-label">Looking up codes based on
label</h3>
<p>Using the <code>code</code> function it is possible to look up the
codes based on a set of labels. For example, below we look up the code
for ‘Hammer’:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">code</span>(<span class="st">&quot;Hammer&quot;</span>, objectcodes)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;B01&quot;</span></span></code></pre></div>
<p>It is also possible to pass in the variable (an object with a
<code>codelist</code> attribute) instead of the code list itself:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">code</span>(<span class="st">&quot;Hammer&quot;</span>, objectsales<span class="sc">$</span>product)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;B01&quot;</span></span></code></pre></div>
<p>This could be used to make selections. For example, instead of</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">subset</span>(objectsales, product <span class="sc">==</span> <span class="st">&quot;B02&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>   product unitprice quantity totalprice</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="dv">33</span>     B02    <span class="fl">284.85</span>       <span class="dv">52</span>   <span class="fl">14812.20</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="dv">73</span>     B02    <span class="fl">125.85</span>       <span class="dv">73</span>    <span class="fl">9187.05</span></span></code></pre></div>
<p>one can do</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">subset</span>(objectsales, product <span class="sc">==</span> <span class="fu">code</span>(<span class="st">&quot;Electric Drill&quot;</span>, product))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>   product unitprice quantity totalprice</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dv">33</span>     B02    <span class="fl">284.85</span>       <span class="dv">52</span>   <span class="fl">14812.20</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dv">73</span>     B02    <span class="fl">125.85</span>       <span class="dv">73</span>    <span class="fl">9187.05</span></span></code></pre></div>
<p>In general the latter is more readable and makes the intent of the
code much more clear (unless one can assume that the people reading the
code will now most of the product codes).</p>
<p>Selecting this was has an advantage over selecting records based on
character vectors or factor vectors. For example we could also have done
the following:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">subset</span>(objectsales, <span class="fu">label</span>(product) <span class="sc">==</span> <span class="st">&quot;Electric Drill&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>   product unitprice quantity totalprice</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="dv">33</span>     B02    <span class="fl">284.85</span>       <span class="dv">52</span>   <span class="fl">14812.20</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="dv">73</span>     B02    <span class="fl">125.85</span>       <span class="dv">73</span>    <span class="fl">9187.05</span></span></code></pre></div>
<p>However, a small, difficult to spot, spelling mistake would have
resulted in:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">subset</span>(objectsales, <span class="fu">label</span>(product) <span class="sc">==</span> <span class="st">&quot;Electric drll&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] product    unitprice  quantity   totalprice</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span><span class="dv">0</span> rows<span class="sc">&gt;</span> (or <span class="dv">0</span><span class="sc">-</span>length row.names)</span></code></pre></div>
<p>And we could have believed that no electric drills were sold. The
<code>code</code> function will also check if the provided labels are
valid and if not will generate an error (the <code>tryCatch</code> is to
make sure don’t actually throw an error).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">tryCatch</span>({</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">subset</span>(objectsales, product <span class="sc">==</span> <span class="fu">code</span>(<span class="st">&quot;Electric drill&quot;</span>, product))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }, <span class="at">error =</span> \(e) <span class="fu">cat</span>(<span class="st">&quot;Error:&quot;</span>, <span class="fu">conditionMessage</span>(e), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>Error<span class="sc">:</span> Labels not present <span class="cf">in</span> codelist <span class="cf">in</span> current locale. </span></code></pre></div>
<p>Since selecting on labels is a common operation, there is also the
<code>inlabels</code> function that will return a logical vector
indicating whether or not a code has a label in the given set:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">subset</span>(objectsales, <span class="fu">inlabels</span>(product, <span class="st">&quot;Electric Drill&quot;</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>   product unitprice quantity totalprice</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="dv">33</span>     B02    <span class="fl">284.85</span>       <span class="dv">52</span>   <span class="fl">14812.20</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="dv">73</span>     B02    <span class="fl">125.85</span>       <span class="dv">73</span>    <span class="fl">9187.05</span></span></code></pre></div>
<p>This function will of course also generate an error in case of
invalid codes.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">tryCatch</span>({</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">subset</span>(objectsales, <span class="fu">inlabels</span>(product, <span class="st">&quot;Electric drill&quot;</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }, <span class="at">error =</span> \(e) <span class="fu">cat</span>(<span class="st">&quot;Error:&quot;</span>, <span class="fu">conditionMessage</span>(e), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>Error<span class="sc">:</span> Labels not present <span class="cf">in</span> codelist <span class="cf">in</span> current locale. </span></code></pre></div>
<p>In the examples above we used the base function <code>subset</code>,
but this will of course also work within <code>data.tables</code> and
the <code>filter</code> methods from <code>dplyr</code>.</p>
<h3 id="assignment-of-codes">Assignment of codes</h3>
<p>When the vector with codes is transformed to a <code>coded</code>
object. It can of course also be assigned to:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectsales<span class="sc">$</span>product[<span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="st">&quot;A01&quot;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectsales<span class="sc">$</span>product[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] B01 B01 B01 A03 A01 A03 A03 B01 A03 A01</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> Codelist<span class="sc">:</span> <span class="fu">A</span>(<span class="ot">=</span>Toys) <span class="fu">B</span>(<span class="ot">=</span>Tools) <span class="fu">A01</span>(<span class="ot">=</span>Teddy Bear) <span class="fu">A02</span>(<span class="ot">=</span>Toy Car) <span class="fu">...X</span>(<span class="ot">=</span>Unknown object)</span></code></pre></div>
<p>Here the <code>coded</code> function can also be of use (again, an
invalid label will result in an error so this is a safe operation):</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectsales<span class="sc">$</span>product[<span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="fu">code</span>(<span class="st">&quot;Teddy Bear&quot;</span>, objectcodes)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectsales<span class="sc">$</span>product[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] B01 B01 B01 A03 A01 A03 A03 B01 A03 A01</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> Codelist<span class="sc">:</span> <span class="fu">A</span>(<span class="ot">=</span>Toys) <span class="fu">B</span>(<span class="ot">=</span>Tools) <span class="fu">A01</span>(<span class="ot">=</span>Teddy Bear) <span class="fu">A02</span>(<span class="ot">=</span>Toy Car) <span class="fu">...X</span>(<span class="ot">=</span>Unknown object)</span></code></pre></div>
<p>Using a <code>coded</code> vector also has the advantage that the
codes assigned to will be validated against the code list, generating an
error when one tries assign an invalid code:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">tryCatch</span>({</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   objectsales<span class="sc">$</span>product[<span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Q&quot;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }, <span class="at">error =</span> \(e) <span class="fu">cat</span>(<span class="st">&quot;Error:&quot;</span>, <span class="fu">conditionMessage</span>(e), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>Error<span class="sc">:</span> Invalid codes used <span class="cf">in</span> value. </span></code></pre></div>
<p>This makes a <code>coded</code> object safer to work with than, for
example, a character of numeric vector with codes (a <code>factor</code>
vector will also generate a warning for invalid factor levels).</p>
<p>Assigning <code>NA</code> will of course still work:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> objectsales<span class="sc">$</span>product[<span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
</body>
</html>
